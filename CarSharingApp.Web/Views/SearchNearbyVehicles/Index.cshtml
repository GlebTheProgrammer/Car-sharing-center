<section class="mt-5 text-center container">
    <div class="row mt-5">
        <div class="col-lg-6 col-md-8 mx-auto">
            <h1 class="fw-light">Fast and Convenient Opportunity</h1>
            <p class="lead text-muted">Please read the instruction below before starting the search.</p>
            <p>
                <button id="searchByCriteriaBtn" type="button" class="btn btn-primary my-2 me-1" data-bs-toggle="modal" data-bs-target="#searchByCriteriaModal">Search vehicles by criteria</button>
            </p>
        </div>
    </div>
</section>

<div class="mt-4">
    <div class="container-fluid">
        <div id="map" class="text-center" style="height: 75vh; width: 100%;"></div>
        <script type="text/javascript">
            var map;
            function initMap(vehicles) {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: 53.90588468960213, lng: 27.555191727187893 },
                    zoom: 11
                });   
                
                infoWindow = new google.maps.InfoWindow();

                const locationButton = document.createElement("button");

                locationButton.textContent = "Pan to My Current Location";
                locationButton.classList.add("custom-map-control-button");
                map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
                locationButton.addEventListener("click", () => {
                    // Try HTML5 geolocation.
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                const pos = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude,
                                };

                                infoWindow.setPosition(pos);
                                infoWindow.setContent("Location found.");
                                infoWindow.open(map);
                                map.setCenter(pos);
                            },
                            () => {
                                handleLocationError(true, infoWindow, map.getCenter());
                            }
                        );
                    } else {
                        // Browser doesn't support Geolocation
                        handleLocationError(false, infoWindow, map.getCenter());
                    }
                });

            }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9AIXs7jB_3r8oRc1zd0i9p0nanEH5Q6M&callback=initMap" async defer></script>
    </div>
</div>
<script>
    var infoWindow;

    //function initMap() {
    //    map = new google.maps.Map(document.getElementById("map"), {
    //        center: { lat: -34.397, lng: 150.644 },
    //        zoom: 6,
    //    });
    //    infoWindow = new google.maps.InfoWindow();

    //    const locationButton = document.createElement("button");

    //    locationButton.textContent = "Pan to Current Location";
    //    locationButton.classList.add("custom-map-control-button");
    //    map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
    //    locationButton.addEventListener("click", () => {
    //        // Try HTML5 geolocation.
    //        if (navigator.geolocation) {
    //            navigator.geolocation.getCurrentPosition(
    //                (position) => {
    //                    const pos = {
    //                        lat: position.coords.latitude,
    //                        lng: position.coords.longitude,
    //                    };

    //                    infoWindow.setPosition(pos);
    //                    infoWindow.setContent("Location found.");
    //                    infoWindow.open(map);
    //                    map.setCenter(pos);
    //                },
    //                () => {
    //                    handleLocationError(true, infoWindow, map.getCenter());
    //                }
    //            );
    //        } else {
    //            // Browser doesn't support Geolocation
    //            handleLocationError(false, infoWindow, map.getCenter());
    //        }
    //    });
    //}

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(
            browserHasGeolocation
                ? "Error: The Geolocation service failed."
                : "Error: Your browser doesn't support geolocation."
        );
        infoWindow.open(map);
    }

    window.initMap = initMap;
</script>