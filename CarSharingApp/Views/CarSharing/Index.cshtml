@using CarSharingApp.Models.VehicleData
@using CarSharingApp.Views.CarSharing
@model CarSharingDataViewModel

@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    List<VehicleViewModel> vehiclesForFirstColumn = Model.Vehicles.Where((vehicle, index) => index % 3 == 0).ToList();
    List<VehicleViewModel> vehiclesForSecondColumn = Model.Vehicles.Where((vehicle, index) => index % 3 == 1).ToList();
    List<VehicleViewModel> vehiclesForThirdColumn = Model.Vehicles.Where((vehicle, index) => index % 3 == 2).ToList();
}

<h1 class="pt-5 mb-4" style="color:black; text-align:center">Explore Sam Car's Prices for Daily and Hourly Car Rental</h1>

<hr class="featurette-divider mt-2 mb-3">

<div class="d-flex flex-row col-sm-12 ">
    <label class="mr-2">Show</label>
    <form asp-controller="CarSharing" asp-action="ChangeDisplayedVehiclesCount" method="post" >
        <select name="data" id="totalVehiclesDisplayedSelect" class="custom-select custom-select-sm form-control form-control-sm">
            <option value="3">3</option>
            <option value="6">6</option>
            <option value="9">9</option>
            <option value="12">12</option>
            <option value="15">15</option>
        </select>
        <button id="changeNumberOfVehiclesBtn" type="submit" class="visually-hidden"></button>
    </form>
    <label class="ml-2">vehicles</label>
    <div class="d-flex flex-row ml-auto">
        <label class="mr-2">Search:</label>
        <input type="search" class="form-control form-control-sm" placeholder="Type here" style="width:70%">
    </div>
</div>

<div class="container">
    <div class="row mt-4">

        <div class="col">
            @{
                foreach (var vehicle in vehiclesForFirstColumn)
                {
                        <div class="card mb-4">
                            <img class="card-img-top" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/2015-bmw-x6.jpg/1200px-2015-bmw-x6.jpg">

                            <div class="card-body">
                                <h3 class="card-title">@vehicle.Name</h3>
                                <p class="card-text">@vehicle.BriefDescription</p>
                                <h4 class="card-text">@vehicle.Tariff.TariffPerHour $<span class="text-muted h5">/hr - </span>@vehicle.Tariff.TariffPerDay $<span class="text-muted h5">/day</span></h4>
                                <a href="#" class="btn btn-primary mt-2" style="width:max-content">Order</a>
                                <a href="#" class="btn btn-info mt-2 ml-1" style="width:max-content">Information</a>
                                <p></p>
                                <p class="card-text"><small class="text-muted">Last taken 3 mins ago</small></p>
                            </div>
                        </div>
                }
            }
        </div>

        <div class="col">
            @{
                foreach (var vehicle in vehiclesForSecondColumn)
                {
                        <div class="card mb-4">
                            <img class="card-img-top" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/2015-bmw-x6.jpg/1200px-2015-bmw-x6.jpg">

                            <div class="card-body">
                                <h3 class="card-title">@vehicle.Name</h3>
                                <p class="card-text">@vehicle.BriefDescription</p>
                                <h4 class="card-text">@vehicle.Tariff.TariffPerHour $<span class="text-muted h5">/hr - </span>@vehicle.Tariff.TariffPerDay $<span class="text-muted h5">/day</span></h4>
                                <a href="#" class="btn btn-primary mt-2" style="width:max-content">Order</a>
                                <a href="#" class="btn btn-info mt-2 ml-1" style="width:max-content">Information</a>
                                <p></p>
                                <p class="card-text"><small class="text-muted">Last taken 3 mins ago</small></p>
                            </div>
                        </div>
                }
            }
        </div>

        <div class="col">
            @{
                foreach (var vehicle in vehiclesForThirdColumn)
                {
                        <div class="card mb-4">
                            <img class="card-img-top" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/2015-bmw-x6.jpg/1200px-2015-bmw-x6.jpg">

                            <div class="card-body">
                                <h3 class="card-title">@vehicle.Name</h3>
                                <p class="card-text">@vehicle.BriefDescription</p>
                                <h4 class="card-text">@vehicle.Tariff.TariffPerHour $<span class="text-muted h5">/hr - </span>@vehicle.Tariff.TariffPerDay $<span class="text-muted h5">/day</span></h4>
                                <a href="#" class="btn btn-primary mt-2" style="width:max-content">Order</a>
                                <a href="#" class="btn btn-info mt-2 ml-1" style="width:max-content">Information</a>
                                <p></p>
                                <p class="card-text"><small class="text-muted">Last taken 3 mins ago</small></p>
                            </div>
                        </div>
                }
            }
        </div>
    </div>
</div>


<div class="d-flex flex-row col-sm-12 ">
    <div class="">
        <div class="dataTables_info" id="dtOrderExample_info" role="status" aria-live="polite">Showing @Model.StartVehiclesIndex to @Model.EndVehiclesIndex of @Model.NumberOfVehicles vehicles</div>
    </div>
    <div class="ml-auto">
        <div class="dataTables_paginate paging_simple_numbers" id="dtOrderExample_paginate">
            <form asp-controller="CarSharing" asp-action="MoveToTheNextPage" method="post">
            <ul class="pagination">
                @{

                    // Prev page button
                    if (Model.PageNumber == 1)
                    {
                        <li class="paginate_button page-item previous disabled">
                            <a onclick="" tabindex="0" class="page-link">Previous</a>
                        </li>
                    }
                    else
                    {
                        <li class="paginate_button page-item previous disabled">
                            <a onclick="" tabindex="0" class="page-link">Previous</a>
                        </li>
                    }


                    // Getting number of total buttons to provide
                    int j = Model.NumberOfVehicles / Model.NumberOfVehiclesDisplayed;
                    if (Model.NumberOfVehicles % Model.NumberOfVehiclesDisplayed != 0)
                        j += 1;

                    int startIndex;
                    int endIndex;

                    if(Model.PageNumber > 6)
                    {
                        startIndex = Model.PageNumber - 3;
                        endIndex = Model.PageNumber + 2;
                    }
                    else
                    {
                        startIndex = 1;
                        endIndex = j;
                    }

                    for (int i = startIndex; i <= endIndex; i++)
                    {
                        if (Model.PageNumber == i)
                        {
                            <li class="paginate_button page-item active">
                                <a tabindex="0" class="page-link">@i</a>
                            </li>
                        }
                        else
                        {
                            <li class="paginate_button page-item">
                                <a tabindex="0" class="page-link">@i</a>
                            </li>
                        }
                    }


                    // Next page button
                    if (Model.PageNumber == j)
                    {
                        <li class="paginate_button page-item next disabled">
                            <a tabindex="0" class="page-link">Next</a>
                        </li>
                    }
                    else
                    {
                        <li class="paginate_button page-item next">
                            <a tabindex="0" class="page-link">Next</a>
                        </li>
                    }
                }
            </ul>
            </form>
        </div>
    </div>
</div>





<script>
    document.addEventListener("DOMContentLoaded", () => {
        localStorage.clear();
    });
</script>


<script>
    document.getElementById("totalVehiclesDisplayedSelect").addEventListener("change", function () {

        var btn = document.getElementById("changeNumberOfVehiclesBtn");
        btn.click();
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        var selectTag = document.getElementById("totalVehiclesDisplayedSelect");
        const options = Array.from(selectTag.options);
        const optionToSelect = options.find(item => item.text === "@Model.NumberOfVehiclesDisplayed");
        selectTag.value = optionToSelect.value;
    });
</script>

<script>
    function submitRequestForTheNextPage() {

    }
</script>